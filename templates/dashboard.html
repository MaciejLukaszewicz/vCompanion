{% extends "base.html" %}

{% block title %}vCompanion - Dashboard{% endblock %}

{% block content %}
<header>
    <div>
        <h1>Global Overview</h1>
        <p style="color: var(--text-dim); font-size: 0.875rem;">
            Summary across {{ vcenter_count }} connected vCenter environment{{ 's' if vcenter_count != 1 else '' }}
        </p>
    </div>
    <div class="search-bar">
        <i data-lucide="search" size="18" style="color: var(--text-dim);"></i>
        <input type="text" placeholder="Search VMs, IPs, Hosts..." hx-get="/api/search"
            hx-trigger="keyup changed delay:500ms" hx-target="#search-results">
    </div>
</header>

<!-- Stats Grid -->
<section class="stats-grid" hx-get="/api/vcenters/stats-cards" hx-trigger="vcenter-refreshed from:body, every 60s"
    hx-swap="innerHTML">
    {% include "partials/stats_grid.html" %}
</section>

<!-- Recent Events Table -->
<section class="table-container" style="margin-top: 2rem;">
    <div
        style="padding: 1.5rem; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center;">
        <h2 style="font-size: 1rem; font-weight: 600;">Recent Critical Events</h2>
        <a href="#" style="color: var(--primary); font-size: 0.875rem; text-decoration: none;">View All</a>
    </div>
    <table>
        <thead>
            <tr>
                <th>Event</th>
                <th>vCenter</th>
                <th>Target</th>
                <th>Status</th>
                <th>Time</th>
            </tr>
        </thead>
        <tbody>
            {% if events %}
            {% for event in events %}
            <tr>
                <td>{{ event.description }}</td>
                <td>{{ event.vcenter }}</td>
                <td>{{ event.target }}</td>
                <td><span class="status-badge {{ event.severity }}">{{ event.severity | title }}</span></td>
                <td>{{ event.time }}</td>
            </tr>
            {% endfor %}
            {% else %}
            <tr>
                <td colspan="5" style="text-align: center; color: var(--text-dim); padding: 4rem;">
                    <div style="display: flex; flex-direction: column; align-items: center; gap: 1rem;">
                        <i data-lucide="info" size="32"></i>
                        <p>Waiting for infrastructure data updates...</p>
                    </div>
                </td>
            </tr>
            {% endif %}
        </tbody>
    </table>
</section>
{% endblock %}

{% block extra_scripts %}
<script>
    // Lucide icons refresh
    lucide.createIcons();
</script>
{% endblock %}