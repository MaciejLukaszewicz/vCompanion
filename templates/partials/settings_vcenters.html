{% if success_msg %}
<div class="alert alert-success" style="margin-bottom: 1.5rem;">
    <i data-lucide="check-circle"></i>
    {{ success_msg }}
</div>
{% endif %}

<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
    <h2 style="font-size: 1.25rem; display: flex; align-items: center; gap: 0.5rem;">
        <i data-lucide="server-cog" size="24" style="color: var(--primary);"></i>
        vCenter Servers
    </h2>
    <button class="btn-primary" onclick="openAddVcenterModal()" style="padding: 0.5rem 1rem;">
        <i data-lucide="plus"></i> Add vCenter
    </button>
</div>

<div id="vcenter-list-container">

    <table class="data-table">
        <thead>
            <tr>
                <th>
                    <div style="display: flex; align-items: center; gap: 0.5rem;"><i data-lucide="tag" size="14"></i>
                        Name</div>
                </th>
                <th>
                    <div style="display: flex; align-items: center; gap: 0.5rem;"><i data-lucide="link" size="14"></i>
                        Host</div>
                </th>
                <th>
                    <div style="display: flex; align-items: center; gap: 0.5rem;"><i data-lucide="network"
                            size="14"></i> Port</div>
                </th>
                <th>
                    <div style="display: flex; align-items: center; gap: 0.5rem;"><i data-lucide="shield" size="14"></i>
                        SSL</div>
                </th>
                <th>
                    <div style="display: flex; align-items: center; gap: 0.5rem;"><i data-lucide="clock" size="14"></i>
                        Interval</div>
                </th>
                <th>
                    <div style="display: flex; align-items: center; gap: 0.5rem;"><i data-lucide="power" size="14"></i>
                        Status</div>
                </th>
                <th style="text-align: right;">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for vc in vcenters %}
            <tr>
                <td style="font-weight: 600; color: var(--text-main);">{{ vc.name }}</td>
                <td style="color: var(--text-dim); font-family: monospace;">{{ vc.host }}</td>
                <td>{{ vc.port }}</td>
                <td>
                    {% if vc.verify_ssl %}
                    <span
                        style="color: var(--success); display: flex; align-items: center; gap: 0.25rem; font-size: 0.85rem;">
                        <i data-lucide="check" size="14"></i> Verified
                    </span>
                    {% else %}
                    <span
                        style="color: var(--warning); display: flex; align-items: center; gap: 0.25rem; font-size: 0.85rem;">
                        <i data-lucide="alert-circle" size="14"></i> Skip
                    </span>
                    {% endif %}
                </td>
                <td>{{ vc.refresh_interval or 'Auto' }}s</td>
                <td>
                    {% if vc.enabled %}
                    <span
                        style="color: var(--success); background: rgba(var(--success-rgb), 0.1); padding: 2px 8px; border-radius: 4px; font-size: 0.75rem; font-weight: 600; border: 1px solid rgba(var(--success-rgb), 0.2);">ENABLED</span>
                    {% else %}
                    <span
                        style="color: var(--text-dim); background: rgba(255, 255, 255, 0.05); padding: 2px 8px; border-radius: 4px; font-size: 0.75rem; font-weight: 600; border: 1px solid var(--border);">DISABLED</span>
                    {% endif %}
                </td>
                <td style="text-align: right;">
                    <div style="display: flex; justify-content: flex-end; gap: 0.5rem;">
                        <button class="btn-icon" onclick="openEditVcenterModal('{{ vc.id }}')"
                            title="Edit Configuration">
                            <i data-lucide="edit-3" size="16"></i>
                        </button>
                        <button class="btn-icon btn-icon-danger" hx-post="/api/settings/vcenters/delete/{{ vc.id }}"
                            hx-confirm="Are you sure you want to remove this vCenter? This will not disconnect active sessions until server restart, but will remove it from configuration."
                            hx-target="#vcenter-list-container" title="Remove vCenter">
                            <i data-lucide="trash-2" size="16"></i>
                        </button>
                    </div>
                </td>
            </tr>
            {% endfor %}
            {% if not vcenters %}
            <tr>
                <td colspan="7" style="text-align: center; padding: 4rem 2rem; color: var(--text-dim);">
                    <div style="display: flex; flex-direction: column; align-items: center; gap: 1rem;">
                        <div style="background: rgba(var(--primary-rgb), 0.1); padding: 1rem; border-radius: 50%;">
                            <i data-lucide="server-off" size="32" style="color: var(--primary);"></i>
                        </div>
                        <p>No vCenter servers configured yet.</p>
                        <button class="btn-secondary" onclick="openAddVcenterModal()" style="font-size: 0.875rem;">
                            Configure your first connection
                        </button>
                    </div>
                </td>
            </tr>
            {% endif %}
        </tbody>
    </table>
</div>

<script>
    // Refresh icons inside the container after HTMX update
    if (typeof refreshIcons === 'function') {
        refreshIcons(document.getElementById('vcenter-list-container'));
    }
    // Also refresh top header icons
    if (typeof lucide !== 'undefined') lucide.createIcons();
</script>