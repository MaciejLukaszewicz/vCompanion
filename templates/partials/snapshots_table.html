<!-- OOB update for the snapshot count in the header -->
<span id="snap-count-badge" hx-swap-oob="innerHTML">{{ snap_count or 0 }}</span>

{% if global_snapshots %}
<table class="inventory-list-table">
    <thead>
        <tr>
            <th style="width: 5%; text-align: center;">
                <input type="checkbox" id="selectAllSnapshots" onclick="toggleAllSnapshots(this)">
            </th>
            <th style="width: 20%">VM Name</th>
            <th style="width: 15%">vCenter</th>
            <th style="width: 15%">Snapshot Name</th>
            <th style="width: 10%">Age</th>
            <th style="width: 15%">Created At</th>
            <th style="width: 15%">Description</th>
            <th style="width: 5%; text-align: right;">Delete</th>
        </tr>
    </thead>
    <tbody>
        {% for snap in global_snapshots %}
        <tr class="vm-row vc-color-{{ snap.vc_color_index }}" data-vm-id="{{ snap.vm_id }}"
            data-vcenter-id="{{ snap.vcenter_id }}"
            data-search="{{ (snap.vm_name ~ ' ' ~ snap.name ~ ' ' ~ (snap.description or '')) | lower }}"
            hx-get="/api/inventory/vm-details/{{ snap.vcenter_id }}/{{ snap.vm_id }}" hx-target="#vm-details-panel"
            hx-trigger="click" onclick="syncVmSelection('{{ snap.vcenter_id }}', '{{ snap.vm_id }}')">
            <td style="text-align: center;" onclick="event.stopPropagation()">
                <input type="checkbox" class="snapshot-checkbox" value="{{ snap.name }}" data-vm-id="{{ snap.vm_id }}"
                    data-vcenter-id="{{ snap.vcenter_id }}" data-vm-name="{{ snap.vm_name }}"
                    data-created="{{ snap.created.replace('T', ' ').split('.')[0] }}"
                    data-description="{{ snap.description or '--' }}" onchange="updateSnapshotDeleteState()">
            </td>
            <td style="font-weight: 600; color: var(--text-main);">{{ snap.vm_name }}</td>
            <td style="font-size: 0.75rem; color: var(--text-dim);">{{ snap.vcenter_name }}</td>
            <td style="color: var(--primary); font-weight: 500;">{{ snap.name }}</td>
            <td>
                {% if snap.age_days < 2 %} <span class="age-pill age-new">{{ snap.age_days }}d</span>
                    {% elif snap.age_days <= 3 %} <span class="age-pill age-mid">{{ snap.age_days }}d</span>
                        {% else %}
                        <span class="age-pill age-old">{{ snap.age_days }}d</span>
                        {% endif %}
            </td>
            <td style="font-size: 0.8rem; color: var(--text-dim);">{{ snap.created.replace('T', ' ').split('.')[0] }}
            </td>
            <td style="font-size: 0.75rem; color: var(--text-dim);" title="{{ snap.description }}">{{ snap.description
                or '--' }}</td>
            <td style="text-align: right;" onclick="event.stopPropagation()">
                <!-- Privileged Delete Action -->
                <div
                    style="background: rgba(239, 68, 68, 0.05); border: 1px solid rgba(239, 68, 68, 0.1); padding: 0.2rem 0.4rem; border-radius: 4px; display: inline-flex; align-items: center; gap: 0.5rem;">
                    <i data-lucide="{{ 'shield-check' if elevated_unlocked else 'shield-alert' }}" size="12"
                        style="color: {{ 'var(--success)' if elevated_unlocked else 'var(--danger)' }}; opacity: 0.8;"
                        title="{{ 'Elevated Privileges Unlocked' if elevated_unlocked else 'Elevated Privileges Locked - go to Settings to unlock' }}"></i>

                    <button type="button" class="btn-icon"
                        title="{% if not elevated_unlocked %}Requires elevated privileges{% else %}Delete snapshot{% endif %}"
                        style="color: var(--danger); padding: 0.25rem; {% if not elevated_unlocked %}opacity: 0.3; cursor: not-allowed;{% endif %}"
                        {% if not elevated_unlocked %}disabled{% endif %}
                        onclick="deleteSnapshot('{{ snap.vcenter_id }}', '{{ snap.vm_id }}', '{{ snap.name }}', this)">
                        <i data-lucide="trash-2" size="16"></i>
                    </button>
                </div>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<div style="padding: 4rem; text-align: center; color: var(--text-dim);">
    <i data-lucide="camera-off" size="48" style="margin-bottom: 1rem; opacity: 0.2;"></i>
    <p>No snapshots found across all connected environments.</p>
</div>
{% endif %}